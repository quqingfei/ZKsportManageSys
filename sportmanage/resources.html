<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>管理页面</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="css/main_2.css"></link>
<link rel="stylesheet" href="css/easyui2.min.css"></link>
<link rel="stylesheet" href="css/icon.css"></link>
<style>
#fm { margin: 0; padding: 10px} .ftitle { font-weight: bold; padding: 5px 0; margin-bottom: 10px; border-bottom: 1px solid #ccc; } .fitem { margin-bottom: 5px; } .fitem label { display: inline-block; width: 80px; } .fitem input { width: 160px; }
</style>
</head>
<body>
	
	<div style="width: 100%; height: 100%;">
	<div class="main_pp" style="position: absolute; top: 0; left: 0;">
		<div class="main_go">
			<div class="main_sty">宅客网络后台管理系统</div>
			<div class="main_mov">
				当前用户：<span id="user_id" style="color: yellow;"></span> , <span
					style="margin-right: 10px;">欢迎使用宅客管理系统</span> [<a
					href="javascript:void(0)" onclick="logout()">退出</a>]
			</div>
		</div>
	</div>
	<div class="main_guge" style="position: absolute; top: 38px; left: 0;">
		<div class="main_tabim" id="timenow" ></div>
	</div>
		<div
			style="width: 100%; height: 100%;   min-height: 450px;">
			<div style="width: 15%; height: 100%; float: left;  min-width: 210px;">
				<div class="main_jian" >
				 <div style="width:100%; height:68px;"></div>
					<div class="main_poy" ></div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='main.html'">用户管理 <em
							class="main_xuan_1"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='data.html'">用户健康数据分析 <em
							class="main_xuan_2"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='order.html'">订单管理<em
							class="main_xuan_8"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='product.html'">产品管理<em
							class="main_xuan_9"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='release.html'">文章发布<em
							class="main_xuan_3"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='feedback.html'">用户反馈<em
							class="main_xuan_4"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='app.html'">app版本管理<em
							class="main_xuan_5"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='community.html'">社区管理<em
							class="main_xuan_7"></em></a>
					</div>
					<div class="main_pie"  style="background: #d8d8d8;">
						<a href="javascript:void(0)"
							onclick="window.parent.location='account.html'">安全管理<em
							class="main_xuan_6"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='userMap.html'">销售分布<em
							class="main_xuan_15"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='video.html'">视频管理<em
							class="main_xuan_16"></em></a>
					</div>
					<div class="main_pie">
						<a href="javascript:void(0)"
							onclick="window.parent.location='medal.html'">勋章管理<em
							class="main_xuan_17"></em></a>
					</div>
				</div>
			</div>
			<div style="height: 100%; margin-left: 200px;">
				<div style="width: 98%; height: 100%; min-height: 360px;">
				<div style=" width:100%; height:68px;"></div>
					<div class="main_opt">后台管理 &gt; <a href="account.html" style="color:#000;text-decoration: none;">安全管理</a> &gt; 资源管理</div>
					<div style="height: 15px;"></div>
					<div style="width: 100%; height: 80%;  min-width: 750px;">

						<div class="boyd">
							<table id="dt" 
								style="height: 100%; margin: 0; padding: 0; display: block; overflow: hidden;"
								 data-options="
                url: 'ResourcesAction!list.zk',
                rownumbers: true,
                pagination: true,
                toolbar:'#toolbar',
                pageSize: 30,
                pageList: [30],
                idField: 'id',
                treeField: 'name',
                onBeforeLoad: function(row,param){
                    if (!row) {    // load top level rows
                        param.id = 0;    // set id=0, indicate to load new page rows
                    }
                }
            ">
								<thead>
									<tr>
										<th data-options="field:'name',width:$(this).width() * 0.2">资源名称</th>
										<th data-options="field:'descrition',width:$(this).width() * 0.2">资源描述</th>
										<th data-options="field:'url',width:$(this).width() * 0.2">资源路径</th>
										<th data-options="field:'gmtCreate',align:'center',formatter: formatDate,width:$(this).width() * 0.1">创建时间</th>
										<th data-options="field:'gmtModify',align:'center',formatter: formatDate,width:$(this).width() * 0.1">修改时间</th>
									</tr>
								</thead>
							</table>
							<div id="toolbar">
								<table>
									<tr>
										<!-- <td><input id="txt_word" class="easyui-searchbox"
											style="width: 250px"
											data-options="prompt:'关键字',searcher:searchUser" /></td>
										<td><div class="datagrid-btn-separator"></div></td> -->
										<td><a href="javascript:void(0)"
											class="easyui-linkbutton" iconCls="icon-add"
											plain="true" onclick="toAdd()">增加</a></td>
										<td><div class="datagrid-btn-separator"></div></td>
										<td><a href="javascript:void(0)"
											class="easyui-linkbutton" iconCls="icon-edit"
											plain="true" onclick="toUpdate()">修改</a></td>
										<td><div class="datagrid-btn-separator"></div></td>
										<td><a href="javascript:void(0)"
											class="easyui-linkbutton" iconCls="icon-remove"
											plain="true" onclick="toDel()">删除</a></td>
										<td><div class="datagrid-btn-separator"></div></td>
									</tr>
								</table>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

<!-- New Resource -->
	<div id="addRSdlg" class="easyui-dialog"
		style="width: 500px; height: 350px; padding: 10px 20px" closed="true" modal="true"
		buttons="#dlg-buttons">
		<div class="ftitle">资源信息</div>
		<form id="fm" method="post">
			<div class="fitem">
				<label>上级目录:</label>
				<input class="easyui-combotree" id="parentId" style="width:230px;" data-options="url:'',method:'post'" />
			</div>
			<div class="fitem">
				<label>名称:</label> <input style="width:230px;"  name="name" id="name"
					class="easyui-textbox"  />
					 <input name="id" type="hidden"/>
			</div>
			<div class="fitem">
				<label>资源地址:</label> <input name="url" id="url"
					 style="width:230px;"  class="easyui-textbox"/>
			</div>
			<div class="fitem">
				<label>描述:</label> <input name="descrition" id="descrition"
					data-options="multiline:true" style="width:230px;height:50px" class="easyui-textbox"/>
			</div>
		</form>
		<div id="dlg-buttons">
			<a href="javascript:void(0)" class="easyui-linkbutton c6"
				iconCls="icon-ok" onclick="saveRS()" style="width: 90px">保存</a>
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-cancel" onclick="javascript:$('#addRSdlg').dialog('close')"
				style="width: 90px">取消</a>
		</div>
	</div>	
<!-- update Resource -->
	<div id="updateRSdlg" class="easyui-dialog"
		style="width: 500px; height: 350px; padding: 10px 20px" closed="true" modal="true"
		buttons="#updlg-buttons">
		<div class="ftitle">资源信息</div>
		<form id="fm" method="post">
			<div class="fitem">
				<label>上级目录:</label>
				<input class="easyui-combotree" id="up_parentId" style="width:230px;" data-options="url:'ResourcesAction!tree.zk',method:'post'" />
			</div>
			<div class="fitem">
				<label>名称:</label> <input style="width:230px;"  name="name" id="up_name"
					class="easyui-textbox"  />
					 <input name="up_id" id="up_id" type="hidden"/>
			</div>
			<div class="fitem">
				<label>资源地址:</label> <input name="url" id="up_url"
					 style="width:230px;"  class="easyui-textbox"/>
			</div>
			<div class="fitem">
				<label>描述:</label> <input name="descrition" id="up_descrition"
					data-options="multiline:true" style="width:230px;height:50px" class="easyui-textbox"/>
			</div>
		</form>
		<div id="updlg-buttons">
			<a href="javascript:void(0)" class="easyui-linkbutton c6"
				iconCls="icon-ok" onclick="updateRS()" style="width: 90px">保存</a>
			<a href="javascript:void(0)" class="easyui-linkbutton"
				iconCls="icon-cancel" onclick="javascript:$('#updateRSdlg').dialog('close')"
				style="width: 90px">取消</a>
		</div>
	</div>		
<script src="js/jquery.min.js"></script>
<script src="js/header.js"></script>
<script src="js/jquery.easyui.min1.js"></script>
<script src="js/easyui-lang-zh_CN.js"></script>
<!-- <script src="js/datagrid.common.js"></script> -->
<!-- <script src="js/biz/zk_main.js"></script> -->
<script src="js/format.utils.js"></script>
<script>
$(function() {
	$('#dt').treegrid({
		onLoadSuccess : function(row,data) {
			if (data.total == 0 && data.ERROR == 'No Login!') {
				$.messager.alert('信息提示', '登录超时,请重新登录!', 'error');
				relogin();
			}
		},
		onLoadError : function() {
			alert('出错啦');
		}
	});
});
//搜索
function searchUser(v){
	alert('敬请期待');
	//$("#dt").datagrid('load',{userName:v});
}
//打开对话框
function openDlg(id,title){
	var docHeight = $(document).height();
	$('#'+id).dialog('open').dialog('setTitle',title);
    $(".window-mask").css({ height: docHeight});//patch dialog bug
}
//获取Easyui表单组件值
function getFormVal(id){
	return $("#"+id).textbox("getValue"); 
}
//设置Easyui表单组件值
function setFormVal(id ,value){
	$("#"+id).textbox("setValue",value); 
}
//显示错误信息
function showError(msg){
	$.messager.alert('错误',msg,'error');
}
//显示消息提示
function showTip(msg) {
	$.messager.show({title : "消息",timeout:2000,msg : msg});
}
//刷新表格
function reloadData(){
	$('#dt').treegrid('reload');
}
//新增资源
function toAdd(){
	openDlg('addRSdlg','新增资源');
	$('#fm').form('clear');
	$('#parentId').combotree({url:'ResourcesAction!tree.zk'});
}
//保存资源
function saveRS(){
	var name = getFormVal('name');
	var url = getFormVal('url');
	var descrition = getFormVal('descrition');
	var parentId= getFormVal('parentId');
	$.post('ResourcesAction!save.zk',{name : name ,url : url,descrition : descrition,parentId :parentId},function(data){
		if(data.STATUS){
			$('#addRSdlg').dialog('close');
			reloadData();
			showTip('操作成功!');
		}else{
			showError(data.INFO);
		}
	},'json');
}
//修改资源
function toUpdate(){
	var row = $('#dt').treegrid('getSelected');
	if (row){
		openDlg('updateRSdlg','修改资源');
		$('#up_id').val(row.id);
		setFormVal('up_name' ,row.name);
		setFormVal('up_url',row.url);
		setFormVal('up_descrition',row.descrition);
		$('#up_parentId').combotree('setValue', row.parentId);
		//$('#fm-uo').form('reset');
		//$('#uoplatform').combobox({url:'PlatformAction!getAll1.zk?item='+row.platform});
		//$('#uoDeliveryRegion').combobox({url:'productAction!getRegions.zk?selected='+row.region});
	}else{
		showError('请先选择需要修改的资源');
	}
}
//保存资源
function updateRS(){
	var name = getFormVal('up_name');
	var url = getFormVal('up_url');
	var descrition = getFormVal('up_descrition');
	var parentId= getFormVal('up_parentId');
	var id = $('#up_id').val();
	//alert('id：'+id);
	//return;
	$.post('ResourcesAction!update.zk',{id:id,name : name ,url : url,descrition : descrition,parentId :parentId},function(data){
		if(data.STATUS){
			$('#updateRSdlg').dialog('close');
			reloadData();
			showTip('操作成功!');
		}else{
			showError(data.INFO);
		}
	},'json');
}
//删除资源
function toDel(){
	var row = $('#dt').treegrid('getSelected');
	if (row){
		$.messager.confirm('删除资源', '确定删除该资源吗?', function(r){
            if (r){
            	$.post('ResourcesAction!delete.zk',{id:row.id},function(data){
            		if(data.STATUS){
            			reloadData();
            			showTip('操作成功!');
            		}else{
            			showError(data.INFO);
            		}
            	},'json');
            }
		});
	}else{
		showError('请先选择需要删除的资源');
	}
}
</script>
</body>
</html> 