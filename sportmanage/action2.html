
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>宅客运动后台管理系统</title>
    <link rel="stylesheet" href="css/easyui2.min.css"></link>
    <link rel="stylesheet" href="css/icon.css"></link>
    <link rel="stylesheet" href="css/theme-simple.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="js/fancybox/jquery.fancybox.css"/>
    <style type="text/css">
        a{
            cursor:pointer;
        }
        #fm{
            margin:0;
            padding:10px 30px;
        }
        .ftitle{
            font-size:14px;
            font-weight:bold;
            padding:5px 0;
            margin-bottom:10px;
            border-bottom:1px solid #ccc;
        }
        .fitem{
            margin-bottom:5px;
        }
        .fitem label{
            display:inline-block;
            width:80px;
            height:25px;
            line-height:25px;
        }
        .fitem input{
            width:260px;
            height:25px;
            line-height:25px;
        }
        .chooseNoteDiv{
            width:100%;
            height:auto;
        }
        .allNoteDiv{
            width:100%;
            height:auto;
        }
        .showNotesDiv{
            width:100%;
            height:auto;
            /*
            border:1px soloid #95b8e7;
            -webkit-box-shadow:2px 2px 3px #95b8e7;
            -moz-box-shadow: 2px 2px 3px #95b8e7;
            box-shadow:2px 2px 3px #95b8e7;
            */
            margin:auto;
        }
        .showNoteDiv{
            width:100%;
            height:auto;
            padding-top:10px;
        }

        .showNotesTitle{
            width:100%;
            height:40px;
            background:#95b8e7;
        }
        .showUserIconDiv{
            width:60px;
            height:auto;
            float:left;
        }
        .showUserIcon{
            width:60px;
            height:auto;
            max-height:150px;
        }
        .showNoteMessage{
            width:500px;
            height:auto;
            margin-left:10px;
            float:right;
        }
        .showUserMessage{
            width:100%;
            height:30px;
        }
        .showUserName{
            width:auto;
            height:30px;
            line-height:30px;
            font-size:18px;
            float:left;
        }
        .showUserLevel{
            width:auto;
            height:20px;
            max-width:100px;
            margin:5px 10px;
            float:left;
        }
        .isTop{
            width:auto;
            height:30px;
            line-height:30px;
            font-size:18px;
            color:red;
            float:right;
        }
        .showNoteWord{
            width:100%;
            height:20px;
            line-height:20px;
            font-size:14px;
            text-align:left;
        }
        .showNoteImages{
            width:100%;
            height:auto;
            margin-top:10px;
        }
        .showNoteImage{
            width:150px;
            height:160px;
            float:left;
            margin-left:5px;
            overflow:hidden;
        }
        .maxImage{
            width:150px;
            max-width:150px;
            height:160px;
        }
        .showNoteBottom{
            width:100%;
            height:30px;
            padding-top:10px;
        }

        .showNoteTime{
            width:auto;
            height:100%;
            line-height:30px;
            font-size:13px;
            color:#999999;
            float:left;
        }
        .noteAction{
            width:auto;
            height:100%;
            line-height:30px;
            font-size:13px;
            color:red;
            float:right;
        }
        .pageDiv{
            width:250px;
            height:25px;
            margin:10px auto;
        }
        .pageDiv a{
            padding:0 8px;
            height:25px;
            line-height:25px;
            display:block;
            float:left;
            text-decoration:underline;
            color:#666;
        }
        .segmentation{
            width: 100%;
            height: auto;
            clear: both;
            border-bottom: 1px solid #d8d8d8;
            padding-top: 10px;
        }
    </style>
    <script>

    </script>
</head>
<body>
<div region="north" border="false" class="group wrap header" style="height: 66px; font-size: 100%">
    <div class="content">
        <div class="logo">
            <div>
                <img src="images/logo.png" alt="宅客运动">
            </div>
        </div>
        <div class="head-right">
            <div style="margin: 5px auto;">当前用户：<span id="userName"></span></div>
            <div style="margin: 8px auto;">
                <a href="javascript:void(0)" id="logout" class="off"><i class="fa fa-power-off"></i>退出系统</a>
            </div>
        </div>
    </div>
</div>
<div class="left-region">
    <ul id="accordion" class="accordion">
        <li>
            <div class="link">
                <i class="fa fa-user"></i><a href="main1.html">用户管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-cart-plus"></i><a href="order1.html">订单管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-suitcase"></i><a href="product1.html">产品管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-globe"></i><a href="community1.html">社区管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-newspaper-o"></i><a href="release1.html">资讯管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-university"></i><a href="gym.html">健身房管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-user-plus"></i><a href="coach1.html">教练管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-globe"></i><a href="course1.html">课程管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-comment"></i><a href="service1.html">客服管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-archive"></i><a href="appProducts.html">app商品管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-calendar-o"></i><a href="appOrder.html">app订单管理</a>
            </div>
        </li>
        <li class="open">
            <div class="link">
                <i class="fa fa-bullhorn"></i><a href="action1.html">版块管理</a>
            </div>
        </li>
        <li>
            <div class="link">
                <i class="fa fa-bullhorn"></i><a href="game1.html">比赛管理</a>
            </div>
        </li>
        <li>
            <div class="link dropdown">
                <i class="fa fa-mobile"></i>APP管理<i class="fa fa-chevron-down"></i>
            </div>
            <ul class="submenu">
                <li><a href="app1.html">版本管理</a></li>
                <li><a href="feedback1.html">反馈管理</a></li>
                <li><a href="video1.html">视频管理</a></li>
                <li><a href="medal1.html">勋章管理</a></li>
            </ul>
        </li>
        <li>
            <div class="link dropdown">
                <i class="fa fa-unlock-alt"></i>安全管理<i class="fa fa-chevron-down"></i>
            </div>
            <ul class="submenu">
                <li><a href="account1.html">系统用户</a></li>
                <li><a href="resources1.html">资源管理</a></li>
                <li><a href="role1.html">角色管理</a></li>
            </ul>
        </li>
    </ul>
</div>
<div class="center-region">
    <div>
        <ul class="breadcrumb">
            <li>当前位置：</li>
            <li class="active">后台管理 <span class="divider">/</span></li>
            <li class="active">版块管理</li>
        </ul>
        <div>

            <table id="dg" class="easyui-datagrid" style="height:560px; "
                   toolbar="#toolbar" pagination="true"
                   rownumbers="true" fitColumns="true" singleSelect="true" pageSize='30' data-options="url:'ActionlistAction!list.zk',method:'post'">
                <thead>
                <tr>
                    <th data-options="field:'name',align:'center',width:150">版块名称</th>
                    <th data-options="field:'introduction',align:'center',width:250">版块描述</th>
                    <th data-options="field:'tag',align:'center',width:120">tag</th>
                    <th data-options="field:'cover',formatter:formatCover,align:'center',width:150">版块封面</th>
                    <th data-options="field:'isShowApp',formatter:formatShow,align:'center',width:130">是否在app展示</th>
                    <th data-options="field:'startTime',formatter:formatDate,align:'center',width:185">开始时间</th>
                    <th data-options="field:'endTime',formatter:formatDate,align:'center',width:185">结束时间</th>
                    <th data-options="field:'totleUser',align:'center',width:90">参加人数</th>
                    <th data-options="field:'gmtCreate',formatter:formatDate,align:'center',width:185">创建时间</th>
                    <th data-options="field:'gmtModify',formatter:formatDate,align:'center',width:185">修改时间</th>
                    <th data-options="field:'id',formatter:formatId,align:'center',width:160">帖子合集</th>
                </tr>
                </thead>
            </table>
            <div id="toolbar">
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="newAction()">添加活动</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="editAction()">编辑信息</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="destroyAction()">删除活动</a>
            </div>

            <div id="dlg" class="easyui-dialog" style="width:500px;height:450px;padding:10px 20px"
                 closed="true" buttons="#dlg-buttons">
                <div class="ftitle">活动信息</div>
                <form id="fm" method="post" novalidate>
                    <div class="fitem">
                        <label>活动名称</label>
                        <input name="name" id = "name" class="easyui-textbox" required="true">
                    </div>
                    <div class="fitem">
                        <label>Tag</label>
                        <input name="tag" id = "tag" class="easyui-textbox" required="true">
                    </div>
                    <div class="fitem">
                        <label>活动描述:</label>
                        <input name="introduction" id = "introduction" class="easyui-textbox" data-options="multiline:true" required="true" style="height:50px;">
                    </div>
                    <div class="fitem">
                        <label>展示到app:</label>
                        <select name="isShowApp" id="isShowInApp" class="easyui-combobox"  data-options="editable:false,valueField: 'label',
		textField: 'value',
		data: [{
			label: 'y',
			value: '展示'
		},{
			label: 'n',
			value: '不展示'
		}]" style="width: 75px;height:25px;line-height: 25px;padding-left:10px;">
                        </select>
                    <div class="fitem">
                        <label>开始时间:</label>
                        <input name="startTime" id = "startTime" class="easyui-datetimebox">
                    </div>
                    <div class="fitem">
                        <label>结束时间:</label>
                        <input name="endTime" id = "endTime" class="easyui-datetimebox">
                    </div>
                    <div class="fitem">
                        <label>活动封面:</label>
                        <input name="cover" id = "cover"  type="hidden">
                    </div>
                </form>
                <form id="title_img_form" method="post"  enctype="multipart/form-data">
                    <input type="file" style="display: none;" id="file_title_img"
                           name="name" onchange="uploadImage()" accept="image/*" />
                </form>

                <div style="width: 197px; height: 67px; margin-left:115px; margin-top: -30px;cursor: pointer;" onclick="chooseImage('file_title_img')" title="点击选择图片">
                    <img id="imghead" src="images/yun.png" alt="" style="max-width: 100%; width: auto; max-height: 100%; height: auto" />
                </div>
            </div>
            <div id="dlg-buttons">
                <a href="javascript:void(0)" class="easyui-linkbutton c6" iconCls="icon-ok" onclick="saveAction()" style="width:90px">保存</a>
                <a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')" style="width:90px">取消</a>
            </div>

            <div id="noteDlg" class="easyui-dialog" style="width:650px; height: 500px; padding: 10px 20px;overflow-x:hidden;overflow-y:auto;" closed="true" modal="true" buttons="#dlg-course-btn">
                <div class="chooseNoteDiv">
                    <p id="actionUrl">选中的帖子</p>
                    <input id="noteIds" type="hidden">
                    <div class="segmentation"></div>
                    <div id="chooseNoteDiv" class="chooseNoteDiv"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="js/jquery.min.js"></script>
<script src="js/header.js"></script>
<script src="js/fancybox/jquery.fancybox.pack.js"></script>
<script src="js/jquery.easyui.min1.js"></script>
<script src="js/easyui-lang-zh_CN.js"></script>
<script src="js/datagrid.common.js"></script>
<script src="js/format.utils.js"></script>
<script src="js/jquery.form.js"></script>
<script src="js/flowplayer-3.2.6.min.js"></script>
<script src="js/accordion.js"></script>
<script src="js/jquery.tmpl.min.js"></script>
<script src="js/biz/zk_community.js"></script>
<script src="js/saveRequest.js"></script>
<script id="chooseNoteTmpl" type="text/x-jquery-tmpl">
	<div class="showNotesDiv">
        <div class="showNoteDiv">
            <div class="showUserIconDiv">
                <img class="showUserIcon" src="${userIcon}" />
            </div>
       
            <div class="showNoteMessage">
                <div class="showUserMessage">
                    <p class="showUserName">${userName}</p> 
                    <img class="showUserLevel" src="images/vip${level}.png" />
                    {{if isTop}}
                        <p class="isTop" style="color:red; margin-left:10px;">[置顶]</p> 
                    {{/if}} 
                </div>
                <div style="clear:both;"></div>
                <div class="showNoteWord">{{html noteContent}}</div>
                <!--  显示帖子图片 -->
                <div class="showNoteImages">
                    {{each noteImages}} 
                    <div class="showNoteImage"> 
                        <a class="popImage" href="../file/FileCenter!showImage2.zk?name=${name}">
                            <img alt="未获取" class="maxImage" src="../file/FileCenter!showImage2.zk?type=sml&name=${name}"/>
                        </a>                        
                    </div>{{/each}}
                </div>
				<div style="width:100%;height:5px;clear:both;"></div>
                <div class="showNoteBottom">
                    <div class="showNoteTime">
                       <!-- 发帖时间 -->
                         ${gmtCreate}
                    </div>
                    <div class="noteAction">
                        <a id="${id}_choose" onclick="deleteNote('${id}')">删除</a>
                    </div>
                </div>
                
            </div>
        </div>
        <div class="segmentation"></div>
    </div>
</script>

<script type="text/javascript">

    $(function(){
        $('#dg').datagrid({
            onLoadSuccess: function(data){
                if (data.total == 0 && data.ERROR == 'No Login!') {
                    //$.messager.alert('信息提示', '登录超时,请重新登录!', 'error');
                    //relogin();
                    var user_id =  localStorage.getItem('user_id');
                    var user_pwd = localStorage.getItem('user_pwd');
                    if(user_id==''||!user_id||user_pwd==''||!user_pwd){
                        $.messager.alert('信息提示', '登录超时,请重新登录!', 'error');
                        relogin();
                    }
                    else{
                        $.post('loginAction!login1.zk',{user_id:user_id,user_pwd:user_pwd},function(data){
                            if(data.STATUS){
                                $('#dg').datagrid('reload');
                            }
                        },'json').complete(function(){
                            $('#dg').datagrid('reload');
                        });
                    }
                }
                //图片弹出层
                $("a.popImage").fancybox({
                    openEffect  : 'elastic',
                    closeEffect: 'elastic'
                });
            },
            onLoadError : function() {
                alert('出错啦');
            }
        });
    });
    var url;
    var id=null;//标记客服是否存在
    function checkAction(name){
        $.getJSON('ActionlistAction!checkAction.zk',{name:name},function(data){
            if(data.STATUS){
                $.messager.alert('警告','活动已经存在!');
                $("#name").focus();
                return false;
            }else {

            }

        });
    }
    function newAction(){
        id = null;
        $("#imghead").attr("src", 'images/yun.png');
        $('#fm').form('clear');
        $('#dlg').dialog('open').dialog('setTitle','编辑版块信息');
        url = 'ActionlistAction!add.zk';
    }

    function editAction(){
        var row = $('#dg').datagrid('getSelected');
        if (!row){
            alert('请先选择要编辑的比赛!');
            return;
        }
        if (row){
            id = row.id;
            $('#dlg').dialog('open').dialog('setTitle','编辑版块信息');
            $("#name").textbox("setValue",row.name);
            $("#tag").textbox("setValue",row.tag);
            $("#isShowInApp").combobox("setValue",row.isShowApp);
            $("#introduction").textbox("setValue",row.introduction);
            var startTime=formatDate(row.startTime);
            $("#startTime").datetimebox("setValue",startTime);
            var endTime=formatDate(row.endTime);
            $("#endTime").datetimebox("setValue",endTime);
            url = 'ActionlistAction!update.zk?id='+row.id;
            var imgURL = "../file/FileCenter!showImage2.zk?name=" + row.cover;
            $("#imghead").attr("src", imgURL);
            $("#cover").val(row.cover);
        }else{
            $.messager.alert('警告','请先选择要编辑的活动!');
        }
    }
    function chooseImage(id) {
        document.getElementById(id).click();
    }

    //上传文章图片
    function uploadImage(){
        //alert('upload');
        var viewFiles = document.getElementById("file_title_img");
        //是否为图片类型
        if(/image\/\w+/.test(viewFiles.files[0].type)){
            //最大图片文件大小 500KB
            var imgSizeLimit = 500 * 1024;
            if(viewFiles.files[0].size<=imgSizeLimit){
                //上传图片
                $("#title_img_form").ajaxSubmit({
                    type : 'post',
                    url : '../file/FileCenter!uploadImage2.zk',
                    success : function(data) {
                        data = $.parseJSON(data);
                        if (data.name) {
                            // alert(data.name);
                            var imgURL = "../file/FileCenter!showImage2.zk?name=" + data.name;
                            $("#imghead").attr("src", imgURL);
                            $("#cover").val(data.name);

                        } else {
                            alert("上传图片出错！");
                        }
                        $("#title_img_form").resetForm();
                    },
                    error : function(XmlHttpRequest, textStatus, errorThrown) {
                        alert("error");
                    }
                });
            }else{
                alert("图片大小不能超过"+(imgSizeLimit/1024)+"KB!");
            }
        }else{
            alert('请选择图片类型的文件!');
        }
    }

    //封面转换
    function formatCover(value){
        if(value==''||!value)
            return '暂无图片';
        else{
            return "<a class=\"popImage\" href='../file/FileCenter!showImage2.zk?name="+value+"'>"
                    +"<img title='图片' style='width:30px;height:20px;margin-top:0px;cursor:pointer;' src='../file/FileCenter!showImage2.zk?name="+value+"'/>"+"</a>";
        }
    }
    var curActionId
    function formatId(value){
        return "<a href='#' onclick=showNotes('"+value+"')>查看合集</a>";
    }
    //check form
    function checkForm(){
        var name =$("#name").textbox("getValue");
        if(name==''){
            $.messager.alert('警告','活动名称不能为空!');
            $("#name").focus();
            return false;
        }
        var tag =$("#tag").textbox("getValue");
        if(tag ==''){
            $.messager.alert('警告','tag不能为空!');
            $("#tag").focus();
            return false;
        }
        var isShowApp =$("#isShowInApp").combobox("getValue");
        if(isShowApp==''){
            $.messager.alert('警告','请选择是否在app中展示!');
            $("#isShowInApp").focus();
            return false;
        }
        var introduction =$("#introduction").textbox("getValue");
        if(introduction==''){
            $.messager.alert('警告','活动描述不能为空!');
            $("#introduction").focus();
            return false;
        }
        var startTime = $.trim($("#startTime").datetimebox('getValue'));
        if(startTime==''){
            $.messager.alert('警告','开始时间不能为空!');
            $("#startTime").focus();
            return false;
        }
        var endTime = $.trim($("#endTime").datetimebox('getValue'));
        if(endTime==''){
            $.messager.alert('警告','结束时间不能为空!');
            $("#endTime").focus();
            return false;
        }
        var cover = $.trim($("#cover").val());
        if(cover==''){
            $.messager.alert('警告','活动封面不能为空!');
            $("#cover").focus();
            return false;
        }
        return true;
    }
    function saveAction(){
        if(checkForm()){
            var name=$("#name").textbox("getValue");
            var tag=$("#tag").textbox("getValue");
            var introduction = $("#introduction").textbox("getValue");
            var startTime=$("#startTime").datetimebox("getValue");
            var endTime=$("#endTime").datetimebox("getValue");
            var cover =$("#cover").val();
            $.post(url,{name:name,tag:tag,introduction:introduction,startTime:startTime,endTime:endTime,cover:cover},function(data){
                if(data.STATUS){
                    showTip("保存成功");
                    $("#dlg").dialog("close");
                    $("#dg").datagrid("reload");
                }
                else{
                    showTip("保存失败");

                }
            },"json");
        }

    }

    function destroyAction(){
        var row = $('#dg').datagrid('getSelected');
        if(row){
            if(confirm("确定删除该活动信息?")){
                $.getJSON('ActionlistAction!delete.zk',{id:row.id},function(data){
                    if(data.STATUS){
                        $('#dg').datagrid('reload');
                        showTip("删除成功!");
                    }else {
                        showTip("删除失败!");
                    }
                });
            }
        }else{
            $.messager.alert('警告','请先选择活动!');
        }
    }


    function showNotes(actionID){
        actionId = actionID;
        getChooseNotes(pageIndex);
        $('#actionUrl').text("所选帖子    http://www.zhaiker.cn/fatburn/action/actioning.html?id="+actionId);
        $('#noteDlg').dialog('open').dialog('setTitle','帖子合集');
    }

    function deleteNote(noteId){
        var actionIds = [];
        actionIds.push(actionId);
        $.post('ActionlistAction!deleteNote.zk',{noteId:noteId,actionlistId:JSON.stringify(actionIds)},function(data){
            if(data.STATUS){
                $.messager.alert('信息提示', '操作成功!');
            }else{
                $.messager.alert('信息提示', '操作失败!');
            }
        },'json').complete(function(){
            getChooseNotes(pageIndex);
        });
    }
    function formatShow(value){
        if(value =="y"){
            return "展示";
        }else if(value =="n"){
            return "不展示";
        }
    }
    var userId;//操作用户id
    var actionId;//活动id

    var pageIndex = 1;
    var pageSize = 6;
    var pageCount = 1;//总页数
    var paganationSize = 5;
    //获取帖子
    //page  , complaint , keyword
    function getChooseNotes(page){
        pageIndex = page ;
        $.post('ActionlistAction!getNotes.zk',{pageIndex:pageIndex,pageSize:pageSize,actionlistId:actionId},function(data){
            if(data.STATUS){
                //清空
                $("#chooseNoteDiv").empty();
                var notes = data.notes;
                var noteSize = notes.length ;
                var noteIds = [];
                if(noteSize > 0 ){
                    for(var i = 0 ;i< noteSize;i++){
                        var note = notes[i];
                        noteIds[i] = note.id;
                        note.userIcon = "../file/FileCenter!showImage2.zk?type=mdm&name=" + note.userIcon;
                        if(note.noteImages){
                            note.noteImages = eval("("+note.noteImages +")");
                        }
                        if(note.complaint){
                            note.complaint = formatComplaint(note.complaint);
                        }else{
                            note.complaint = null ;
                        }
                        if(note.gmtModify > note.gmtCreate){
                            var now = new Date().getTime();
                            if(note.gmtModify > now){
                                note.isTop = 'y';
                            }
                        }
                        note.gmtCreate = getTimeAgo(note.gmtCreate);
                        note.noteContent = parseNoteContent(note.noteContent);
                    }
                    $.tmpl($("#chooseNoteTmpl").html(), data.notes).appendTo("#chooseNoteDiv");
                    $('#noteIds').val(JSON.stringify(noteIds));
                    //分页
                    //总页数
                    pageCount = data.total;
                    var startPaganation = 1 ;//起始页码行
                    //处理小于paganationSize的情况
                    if(pageIndex <= paganationSize){
                        startPaganation = 1;
                    }else{
                        if( (pageIndex % paganationSize) == 0 ){
                            startPaganation = ( parseInt( pageIndex / paganationSize ) - 1) * paganationSize + 1 ;
                        }else{
                            startPaganation =  parseInt( pageIndex / paganationSize )  * paganationSize + 1 ;
                        }
                    }

                    //页码下一行
                    var endPaganation = startPaganation + ( paganationSize - 1 ) ;//结束页码行
                    if(startPaganation == 1){
                        endPaganation =  paganationSize ;
                    }
                    //结束行超过总页数，结束行设置为总页数
                    if(endPaganation >= pageCount){
                        endPaganation = pageCount;
                    }
                    //上一页页码
                    var prePage = pageIndex - 1;
                    //已到了第一页
                    if(pageIndex == 1){
                        prePage  = 1;
                    }
                    //下一页页码
                    var nextPage = pageIndex + 1;
                    //已到最后一页
                    if(pageIndex == pageCount){
                        nextPage = endPaganation ;
                    }
                    //详细页码
                    $("#chooseNoteDiv").append("<div class='pageDiv' id='note_pages'></div>")
                    $("#note_pages").append("<input style='float: left' type='button' id='noteprePage' value='上一页' onclick='getChooseNotes("+prePage+")' >");
                    for (var i = startPaganation; i <= endPaganation; i++) {
                        if(i == pageIndex){
                            $("#note_pages").append(
                                    "<a style='text-decoration: none; color: #000;' href='javascript:void(0)' >" + i + "</a>");
                        }else{
                            $("#note_pages").append(
                                    "<a href='javascript:void(0)' onclick='getChooseNotes("+i+")'>" + i + "</a>");
                        }

                    }
                    $("#note_pages").append("<input style='float: left' type='button' id='notenextPage' value='下一页' onclick='getChooseNotes("+nextPage+")' >");
                    if(pageIndex == 1){
                        $("#noteprePage").attr("disabled",true);
                    }
                    if(pageIndex == pageCount){
                        $("#notenextPage").attr("disabled",true);
                    }
                }else{
                    $("#chooseNoteDiv").html('很抱歉，没有找到动态');
                }

            }
        },'json').complete(function(){
            $("a.popImage").fancybox({
                openEffect  : 'elastic',
                closeEffect: 'elastic'
            });
            $(".showNoteWord").find('a').each(function(){
                $(this).attr('target','_blank');
            });
        });
        $("#dlg").animate({scrollTop:$("#dlg").offset().top},800);
    }

    //格式化时间显示
    function getTimeAgo(time){
        var date = new Date();
        var today = date.setHours(0, 0, 0, 0);
        var yesterday =  date.setDate(date.getDate()-1);
        var beforeYesterday = date.setDate(date.getDate()-1);
        var i = time ;
        if(i <= beforeYesterday){
            return new Date(time).format("MM月dd日 hh:mm");
        }else if(i <= yesterday){
            return "前天  "+new Date(time).format("hh:mm");
        }else if(i <= today){
            return "昨天 "+new Date(time).format("hh:mm");
        }else {
            var now = new Date().getTime();
            var deltaSeconds = (now - i ) / 1000 ;
            if(deltaSeconds < 60){//不超过一分钟
                return '刚刚';
            }else{//不超过一天
                return "今天 " + new Date(time).format("hh:mm");
            }
        }
    }
</script>
</body>
</html>